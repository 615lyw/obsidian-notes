# 权限管理

之前基于 servlet 编程时，认证的做法为：

配置 Filter（通过 `@WebFilter("/api/admin/*")` ），放行 login 请求，认证成功把用户信息放入 session 域中，当访问其他接口时，检查 session 域中是否包含该用户信息，如果包含则放行，如果不包含则拦截。

总结：Filter + session 实现认证。



用户认证的流程：

1. 访问资源

2. 是否允许匿名访问，公开资源不用进行用户认证

3. 之前是否认证过：从页面 A（此时完成了认证）到页面 B（不用再次认证，故检查之前是否认证过即可）

4. 是否认证通过



授权流程：

1. 访问系统资源

2. 先认证：同上认证流程
3. 后授权：查询用户所拥有的权限
4. 将用户已分配到的权限与访问资源所需权限进行判断



权限管理模型

把权限管理抽象成模型，设计相应的数据库表。



基本模型：

用户和权限：（动名词：操作+资源）→ 多对多（双向一对多）



多对多至少 3 张表：两张实体表，一张关系表。一张用户表，一张权限表，一张用户权限关系表（用户 id → 所拥有的权限 id → 根据查到的权限 id 去查权限表）。



两种实现方式：

1. 基于角色的资源访问控制：

```java
if (user instanceof 团长) {
    两个鸡腿+炒饭
} else if (user instanceof 小兵) {
    炒饭
}
```

问题在于角色所拥有的的权限易变会导致代码需要经常改动：

```java
if (user instanceof 团长) {
    发放两个鸡腿+炒饭+荷包蛋
} else if (user instanceof 小兵) {
    发放炒饭+冬瓜汤
}
```

2. 基于权限的资源访问控制：

```java
if (券 instanceof 鸡腿券) {
    发放鸡腿
} else if (券 instanceof 炒饭券) {
    发放炒饭
}
```

# 业界 2 种常用的访问管理框架

- [[Shiro]]
- Spring Security
